function [Data, att] = load_dataset_DS(pkg_dir, dataset, sub_sample, nb_trajectories)

dataset_name = [];
switch dataset
    case 1
        dataset_name = '2D_messy-snake.mat';
    case 2
        dataset_name = '2D_Lshape.mat';
    case 3
        dataset_name = '2D_Ashape.mat';
    case 4
        dataset_name = '2D_Sshape.mat';
    case 5
        dataset_name = '3D_viapoint_2.mat';
        traj_ids = [1 2];
    case 6
        dataset_name = '3D_sink.mat';
    case 7
        dataset_name = '3D_bumpy-snake.mat';
    case 8 
        dataset_name = '3D_Cshape_top.mat';
    case 9
        dataset_name = '3D_Cshape_bottom.mat';               
end

if isempty(sub_sample)
   sub_sample = 2; 
end

if dataset == 1
    Data_ = load(strcat(pkg_dir,'/datasets/',dataset_name));
    Data = Data_.Data(:,1:sub_sample:end);
    att = [0 0]';
elseif dataset <= 5
    data_ = load(strcat(pkg_dir,'/datasets/',dataset_name));
    data = data_.data;
    
    % Computing the attractor and shifting all the trajectories
    N = length(data);att_ = [];
    M = size(data{1},1)/2;
    for n=1:N   
        att_ = [att_ data{n}(1:M,end)];
    end
    att = mean(att_,2);
    shifts = att_ - att;
    Data = [];
    for l=1:N
        % Gather Data
        data_ = data{l}(:,1:sub_sample:end);
        shifts_ = repmat(shifts(:,l),[1 length(data_)]);
        data_(1:M,:)       = data_(1:M,:) - shifts_;
        data_(M+1:end,end) = zeros(M,1);
        data_(M+1:end,end-1) = (data_(M+1:end,end) + zeros(M,1))/2;
        data_(M+1:end,end-2) = (data_(M+1:end,end-2) + data_(M+1:end,end-1))/2;
        Data = [Data data_];
        data_(:,end)
    end
else
    data_ = load(strcat(pkg_dir,'/datasets/',dataset_name));
    data = data_.data;
    N = length(data);    
    Data = [];
    for l=1:length(traj_ids)
        % Gather Data
        data_ = data{traj_ids(l)};
        Data = [Data data_(:,1:sub_sample:end)];
    end
end